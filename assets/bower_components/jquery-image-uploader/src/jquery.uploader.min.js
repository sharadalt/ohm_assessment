void 0!==typeof jQuery&&function(c){var h=function(a){this.init(a);this.main()};h.defaults={fileField:null,urlField:null,urlFieldSubmit:null,hideFileField:!0,hideUrlField:!0,url:null,thumbnails:{div:null,width:null,height:null},maxFileSize:0,allowDuplicate:!1,thumbnailReady:c.noop,onFileAdded:function(a){return!1},onFilesSelected:function(){return!1},onUrlSelected:function(){return!1},onDragStart:function(a){return!1},onDragEnd:function(a){return!1},onDragEnter:function(a){return!1},onDragLeave:function(a){return!1},
onDragOver:function(a){return!1},onDrop:function(a){return!1},onUploadProgress:function(a){return!1},beforeUpload:function(){return!0},afterUpload:function(){return!1},error:function(a){alert(a)}};h.prototype={init:function(a){instance=this;this.options=c.extend({},h.defaults,a);this.canUpload=!0;this.uploadFileList=[];this.allUploadedFileList=[];this.currentThumbnail=null},fileApiSupported:function(){return window.File&&window.FileReader&&window.FileList&&window.FormData},onDragLeave:function(a){if(c(a.target)[0]===
instance.options.dropZone[0])return instance.options.onDragLeave(a)},onDragEnter:function(a){if(c(a.target)[0]===instance.options.dropZone[0])return instance.options.onDragEnter(a)},onDragStart:function(a){a.preventDefault();a.stopPropagation();return instance.options.onDragStart(a)},onDragEnd:function(a){a.preventDefault();a.stopPropagation();return instance.options.onDragEnd(a)},onDragOver:function(a){a.preventDefault();a.stopPropagation();return instance.options.onDragOver(a)},onDrop:function(a){a.preventDefault();
a.stopPropagation();instance.addFiles(a.originalEvent.dataTransfer.files);return instance.options.onDrop(a)},uploadStarted:function(a){instance.options.thumbnails&&(instance.currentThumbnail=instance.options.thumbnails.div.find('[data-upload-status="waiting"]:first'),instance.currentThumbnail.attr("data-upload-status","uploading"),instance.currentThumbnail.append(c('<div class="progress" />').append(c("<div />"))))},onUploadProgress:function(a){a.lengthComputable&&(instance.currentThumbnail&&0!=instance.currentThumbnail.length||
instance.uploadStarted(),instance.currentThumbnail&&instance.currentThumbnail.find(".progress > div").width(100*a.loaded/a.total+"%"));return instance.options.onUploadProgress(a)},uploadComplete:function(a){xhr=a.currentTarget;instance.canUpload=!0;if(200==xhr.status){var b=null;instance.currentThumbnail&&(instance.currentThumbnail.find(".progress > div").width("100%"),b=instance.currentThumbnail,instance.currentThumbnail=null);instance.options.afterUpload(a.target.response,b);instance.uploadNextFile()}else instance.uploadFailed()},
uploadFailed:function(){this.canUpload=!0;this.currentThumbnail&&this.currentThumbnail.remove();this.currentThumbnail=null;this.options.error("upload failed");this.uploadNextFile()},uploadCanceled:function(){this.canUpload=!0;this.currentThumbnail=null;this.options.error("upload canceled");this.uploadNextFile()},addUploadFile:function(a){this.allUploadedFileList.push(a);this.uploadFileList.push(a);this.uploadNextFile()},fileAlreadyUploaded:function(a){for(i in this.allUploadedFileList)if(f=this.allUploadedFileList[i],
a.name==f.name&&a.size==f.size&&a.type==f.type)return!0;return!1},uploadNextFile:function(){this.canUpload&&0<this.uploadFileList.length&&(file=this.uploadFileList.shift(),this.canUpload=!1,this.uploadFile(file))},uploadFile:function(a){xhr=new XMLHttpRequest;if(xhr.upload&&this.options.beforeUpload()){xhr.open("POST",this.options.url);if(a instanceof File){var b=new FormData;b.append("file",a)}else xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b="url="+a.name;xhr.upload.addEventListener("progress",
this.onUploadProgress,!1);xhr.addEventListener("loadstart",this.uploadStarted,!1);xhr.addEventListener("load",this.uploadComplete,!1);xhr.addEventListener("error",this.uploadFailed,!1);xhr.addEventListener("abort",this.uploadCanceled,!1);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send(b)}},onFilesSelected:function(a){a.preventDefault();a.stopPropagation();instance.addFiles(a.target.files);c(this).val("");return instance.options.onFilesSelected()},onUrlSelected:function(a){(a=instance.options.urlField.val())&&
instance.addFileByUrl(a);return instance.options.onUrlSelected()},addFileByUrl:function(a){return this.addFile({name:a})},addFile:function(a){return this.addFiles([a])},addFiles:function(a){if(this.fileApiSupported())for(var b=null,d=0;d<a.length;d++){if(0<this.options.maxFileSize&&file.size>this.options.maxFileSize)return this.options.error("the file you are trying to upload is too big");if(!this.options.allowDuplicate&&this.fileAlreadyUploaded(a[d]))return this.options.error("the file you are trying to upload has already been sent");
this.options.onFileAdded(a[d]);if(this.options.thumbnails||this.options.thumbnailReady!=c.noop)a[d]instanceof File?(this.options.thumbnails.div.file=a[d],b=new FileReader,b.onload=function(a){instance.displayImage(a.target.result)},b.readAsDataURL(a[d])):this.displayImage(a[d].name);try{this.addUploadFile(a[d])}catch(k){this.uploadFailed()}}else alert("files api not supported")},displayImage:function(a){var b=new Image;b.src=a;c(b).hide();var d=c("<div />").attr("data-upload-status","waiting").css({overflow:"hidden",
position:"relative"}).append(b);b.onload=function(){var a=instance.options.thumbnails.width,e=instance.options.thumbnails.height,g=b.width/b.height;instance.options.thumbnails.crop&&0<a&&0<e?(d.width(a),d.height(e),c(b).css("position","absolute"),a/e>g?"zoom"==instance.options.thumbnails.crop?(b.width=a,b.height=a/g,c(b).css("top","-"+parseInt((b.height-e)/2)+"px")):(b.width=e*g,b.height=e,c(b).css("left",parseInt((a-b.width)/2)+"px")):"zoom"==instance.options.thumbnails.crop?(b.height=e,b.width=
e*g,c(b).css("left","-"+parseInt((b.width-a)/2)+"px")):(b.width=a,b.height=e/g,c(b).css("top",parseInt((e-b.height)/2)+"px"))):(0<a?b.width=a:0<e&&(b.width=e*g),0<e?b.height=e:0<a&&(b.height=a/g));c(b).css({width:b.width,height:b.height});c(b).show("slow")};instance.options.thumbnailReady!=c.noop?instance.options.thumbnailReady(d):instance.options.thumbnails.div.append(d)},prepareThumbnails:function(){if(this.options.thumbnails){if("object"!=typeof this.options.thumbnails){var a=null;"string"==typeof this.options.thumbnails&&
(a=c(this.options.thumbnails));this.options.thumbnails={div:a,width:null,height:null}}"string"==typeof this.options.thumbnails.div&&(this.options.thumbnails.div=c(this.options.thumbnails.div));"object"==typeof this.options.thumbnails&&void 0==this.options.thumbnails.div&&(this.options.thumbnails.div=null);null==this.options.thumbnails.div&&(this.options.thumbnails.div=c('<div class="fileUploadThumbnails" />'),this.options.dropZone.after(this.options.thumbnails.div))}},main:function(){var a=this;null!=
this.options.dropZone&&(this.options.dropZone.on("dragstart",this.onDragStart),this.options.dropZone.on("dragend",this.onDragEnd),this.options.dropZone.on("dragleave",this.onDragLeave),this.options.dropZone.on("dragenter",this.onDragEnter),this.options.dropZone.on("dragover",this.onDragOver),this.options.dropZone.on("drop",this.onDrop));null!=this.options.fileField&&("string"==typeof this.options.fileField&&(this.options.fileField=c(this.options.fileField)),this.options.dropZone.on("click",function(){a.options.fileField.trigger("click")}),
this.options.fileField.on("change",this.onFilesSelected),!0==this.options.hideFileField&&this.options.fileField.hide());if(null!=this.options.urlField){"string"==typeof this.options.urlField&&(this.options.urlField=c(this.options.urlField));if(null!==this.options.urlFieldSubmit)"string"==typeof this.options.urlFieldSubmit&&(this.options.urlFieldSubmit=c(this.options.urlFieldSubmit)),this.options.urlFieldSubmit.on("click",this.onUrlSelected);else this.options.urlField.on("change",this.onUrlSelected);
!0==this.options.hideUrlField&&this.options.urlField.hide()}this.prepareThumbnails();return this}};c.fn.imageUploader=function(a){a=c.extend({dropZone:c(this)},a);a=new h(a);c(this).data("imageUploader",a);return this}}(jQuery);
